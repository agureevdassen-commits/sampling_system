# ARCHITECTURE.md - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

## üìê –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                  –ú–û–ë–ò–õ–¨–ù–´–ô –ë–†–ê–£–ó–ï–† / PWA                     ‚îÇ
‚îÇ  (Chrome/Edge –Ω–∞ Android, –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ offline-first)   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚îú‚îÄ‚ñ∫ –ö–∞–º–µ—Ä–∞ (ZXing)
                       ‚îú‚îÄ‚ñ∫ IndexedDB (–ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ)
                       ‚îú‚îÄ‚ñ∫ Service Worker (–∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ)
                       ‚îî‚îÄ‚ñ∫ localStorage (–∫–æ–Ω—Ñ–∏–≥, device ID)
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ              REST API –°–ï–†–í–ï–† (Node.js/Express)              ‚îÇ
‚îÇ  POST /api/scans/bulk - –ø—Ä–∏—ë–º –ø—Ä–æ–±                          ‚îÇ
‚îÇ  GET /api/scans - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏                         ‚îÇ
‚îÇ  GET /api/scans/export/csv - —ç–∫—Å–ø–æ—Ä—Ç                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                       ‚îÇ
                       ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ             –ë–ê–ó–ê –î–ê–ù–ù–´–• (PostgreSQL)                        ‚îÇ
‚îÇ  ‚îú‚îÄ samples (–∑–∞–ø–∏—Å–∏ –ø—Ä–æ–±)                                  ‚îÇ
‚îÇ  ‚îú‚îÄ devices (—É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞)                                    ‚îÇ
‚îÇ  ‚îî‚îÄ sync_logs (–ª–æ–≥–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏)                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## üéØ –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã

### 1. –§—Ä–æ–Ω—Ç–µ–Ω–¥ (PWA)

**–§–∞–π–ª:** `index.html` (–≤—Å—Ç—Ä–æ—ë–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ JavaScript)

**–û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏:**
- **Camera Module** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–æ–º –∏ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ–º —à—Ç—Ä–∏—Ö–∫–æ–¥–æ–≤
- **Database Module (IndexedDB)** - –ª–æ–∫–∞–ª—å–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–æ–± –∏ –ª–æ–≥–æ–≤
- **Sync Module** - —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
- **UI Module** - –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- **Logger Module** - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –≤ –º–µ—Å—Ç–Ω–æ–º —Ö—Ä–∞–Ω–∏–ª–∏—â–µ

**–ö–ª—é—á–µ–≤—ã–µ –∫–ª–∞—Å—Å—ã/—Ñ—É–Ω–∫—Ü–∏–∏:**
```javascript
class Database {
  init()              // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è IndexedDB
  addScan(scan)       // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±—ã
  getPendingScans()   // –ü–æ–ª—É—á–∏—Ç—å –Ω–µ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ
  markSynced()        // –ü–æ–º–µ—Ç–∏—Ç—å –∫–∞–∫ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω–æ
  addLog/getLogs()    // –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
}

function processScan()        // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
function syncPendingScans()   // –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º
function initCamera()         // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞–º–µ—Ä—ã
```

**–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö (IndexedDB):**
```javascript
// Object store: scans
{
  id: number,
  sample: string,
  well_name: string,
  block: string,
  type: string,
  scanned_at: number,
  scanned_by: string,
  sync_status: 'pending' | 'synced',
  server_id?: string,
  is_test: boolean
}

// Object store: logs
{
  id: number,
  ts: number,
  level: 'info' | 'error',
  message: string
}
```

### 2. Service Worker

**–§–∞–π–ª:** `service-worker.js`

**–§—É–Ω–∫—Ü–∏–∏:**
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ä–µ—Å—É—Ä—Å–æ–≤** (cache-first —Å—Ç—Ä–∞—Ç–µ–≥–∏—è)
- **Offline support** - —Ä–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- **API proxy** - —Å–∫–≤–æ–∑–Ω–æ–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏–µ API –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:**
```
/api/* ‚Üí network-first (–≤—Å–µ–≥–¥–∞ –≤ —Å–µ—Ç—å, –±–µ–∑ –∫—ç—à–∞)
–û—Å—Ç–∞–ª—å–Ω–æ–µ ‚Üí cache-first (–∫—ç—à –≤ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–µ, –ø–æ—Ç–æ–º —Å–µ—Ç—å)
```

### 3. –°–µ—Ä–≤–µ—Ä–Ω–æ–µ API

**–§–∞–π–ª:** `server.js` (Node.js/Express)

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```
Express App
‚îú‚îÄ‚îÄ Middleware
‚îÇ   ‚îú‚îÄ‚îÄ helmet (–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å)
‚îÇ   ‚îú‚îÄ‚îÄ cors (–∫—Ä–æ—Å—Å–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)
‚îÇ   ‚îú‚îÄ‚îÄ morgan (–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
‚îÇ   ‚îî‚îÄ‚îÄ body-parser (–ø–∞—Ä—Å–∏–Ω–≥ JSON)
‚îú‚îÄ‚îÄ Static Files (—Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –∏–∑ /public)
‚îî‚îÄ‚îÄ API Routes
    ‚îú‚îÄ‚îÄ GET /api/health
    ‚îú‚îÄ‚îÄ POST /api/scans/bulk
    ‚îú‚îÄ‚îÄ GET /api/scans/count
    ‚îú‚îÄ‚îÄ GET /api/scans
    ‚îî‚îÄ‚îÄ GET /api/scans/export/csv
```

**–í–∞–ª–∏–¥–∞—Ü–∏—è:**
```javascript
// –ü—Ä–æ–≤–µ—Ä–∫–∏ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ POST /api/scans/bulk:
- sample: –Ω–µ–ø—É—Å—Ç–æ–π string
- well_name: –Ω–µ–ø—É—Å—Ç–æ–π string
- block: –Ω–µ–ø—É—Å—Ç–æ–π string
- type: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π string
- scanned_at: number (timestamp)
- scanned_by: string
- device_id: string
```

**–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:**
- API Key –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`
- –ó–∞—â–∏—Ç–∞ –æ—Ç SQL injection (prepared statements)
- Rate limiting (–Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ –±–∞–∑–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏, –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å)

### 4. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (PostgreSQL)

**–¢–∞–±–ª–∏—Ü–∞: samples** (–æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
```sql
CREATE TABLE samples (
  id SERIAL PRIMARY KEY,
  device_id VARCHAR(255) FK,
  local_id INTEGER,           -- –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  sample VARCHAR(255),
  well_name VARCHAR(255),
  block VARCHAR(255),
  type VARCHAR(100),
  scanned_at TIMESTAMP,       -- –≤—Ä–µ–º—è —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  scanned_by VARCHAR(255),
  is_test BOOLEAN,
  created_at TIMESTAMP,       -- –≤—Ä–µ–º—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  updated_at TIMESTAMP
)
```

**–¢–∞–±–ª–∏—Ü–∞: devices** (–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö)
```sql
CREATE TABLE devices (
  id SERIAL PRIMARY KEY,
  device_id VARCHAR(255) UNIQUE,
  description TEXT,
  created_at TIMESTAMP
)
```

**–¢–∞–±–ª–∏—Ü–∞: sync_logs** (–∂—É—Ä–Ω–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π)
```sql
CREATE TABLE sync_logs (
  id SERIAL PRIMARY KEY,
  device_id VARCHAR(255),
  action VARCHAR(50),
  samples_count INTEGER,
  status VARCHAR(20),
  error_message TEXT,
  created_at TIMESTAMP
)
```

**–ò–Ω–¥–µ–∫—Å—ã:**
```
idx_samples_device_id
idx_samples_sample
idx_samples_scanned_at
idx_samples_is_test
idx_samples_block
idx_sync_logs_device_id
idx_sync_logs_created_at
```

## üîÑ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–±—ã

```
1. –í–í–û–î –ù–ê –ö–õ–ò–ï–ù–¢–ï
   ‚îú‚îÄ –û–ø–µ—Ä–∞—Ç–æ—Ä —Å–∫–∞–Ω–∏—Ä—É–µ—Ç —à—Ç—Ä–∏—Ö–∫–æ–¥
   ‚îú‚îÄ –í–≤–æ–¥–∏—Ç —Å–∫–≤–∞–∂–∏–Ω—É –∏ –±–ª–æ–∫
   ‚îî‚îÄ –ù–∞–∂–∏–º–∞–µ—Ç "–ó–∞–ø–∏—Å–∞—Ç—å"

2. –í–ê–õ–ò–î–ê–¶–ò–Ø
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: Sample –Ω–µ –ø—É—Å—Ç–æ–π ‚úì
   ‚îú‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: Block –Ω–µ –ø—É—Å—Ç–æ–π ‚úì
   ‚îî‚îÄ –ü—Ä–æ–≤–µ—Ä–∫–∞: Well_name –Ω–µ –ø—É—Å—Ç–æ–π ‚úì

3. –õ–û–ö–ê–õ–¨–ù–û–ï –°–û–•–†–ê–ù–ï–ù–ò–ï
   ‚îú‚îÄ –ó–∞–ø–∏—Å—å –≤ IndexedDB —Å sync_status = 'pending'
   ‚îú‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI (—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, —Å–ø–∏—Å–æ–∫)
   ‚îî‚îÄ –ó–≤—É–∫–æ–≤–æ–µ/–≤–∏–∑—É–∞–ª—å–Ω–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

4. –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø (–µ—Å–ª–∏ –æ–Ω–ª–∞–π–Ω)
   ‚îú‚îÄ –ö–∞–∂–¥—ã–µ 30 —Å–µ–∫ –∏–ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   ‚îú‚îÄ GET pending –∑–∞–ø–∏—Å–∏ –∏–∑ IndexedDB
   ‚îú‚îÄ POST –Ω–∞ /api/scans/bulk
   ‚îî‚îÄ –ï—Å–ª–∏ —É—Å–ø–µ—Ö: –æ–±–Ω–æ–≤–∏—Ç—å sync_status = 'synced'

5. –ù–ê –°–ï–†–í–ï–†–ï
   ‚îú‚îÄ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
   ‚îú‚îÄ –í—Å—Ç–∞–≤–∫–∞ –≤ —Ç–∞–±–ª–∏—Ü—É samples
   ‚îú‚îÄ –í–æ–∑–≤—Ä–∞—Ç server_ids
   ‚îî‚îÄ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏

6. –•–†–ê–ù–ï–ù–ò–ï –ù–ê –°–ï–†–í–ï–†–ï
   ‚îú‚îÄ –ü–æ—Å—Ç–æ—è–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –≤ PostgreSQL
   ‚îú‚îÄ –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ /api/scans
   ‚îî‚îÄ –≠–∫—Å–ø–æ—Ä—Ç –≤ CSV —á–µ—Ä–µ–∑ /api/scans/export/csv
```

## üì° –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è

### –ê–ª–≥–æ—Ä–∏—Ç–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

```javascript
async function syncPendingScans() {
  if (!navigator.onLine) return;  // –û—Ñ–ª–∞–π–Ω ‚Üí –≤—ã—Ö–æ–¥
  
  pending = await db.getPendingScans();  // –ü–æ–ª—É—á–∏—Ç—å pending
  
  if (pending.length === 0) {
    updateIndicator();  // –û–±–Ω–æ–≤–∏—Ç—å UI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
    return;
  }
  
  payload = pending.map(transform);
  
  response = await fetch('/api/scans/bulk', {
    headers: { 'X-API-Key': API_KEY }
  });
  
  if (response.ok) {
    serverIds = response.json().server_ids;
    await db.markSynced(pendingIds, serverIds);  // –ü–æ–º–µ—Ç–∏—Ç—å synced
    updateStats();
  } else {
    logError(response.status);
  }
}
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ü—Ä–æ–±–∞ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏

**–†–µ—à–µ–Ω–∏–µ:**
1. –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ IndexedDB
2. –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è ‚Üí –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
3. –°–µ—Ä–≤–µ—Ä –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–µ–Ω (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è)
4. –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ ‚Üí –∑–∞–ø–∏—Å—å –æ—Å—Ç–∞—ë—Ç—Å—è pending
5. –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –ø–æ–ø—ã—Ç–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ù–∞ –∫–ª–∏–µ–Ω—Ç–µ
- Service Worker ‚Üí —Ç–æ–ª—å–∫–æ GET –∑–∞–ø—Ä–æ—Å—ã –∫—ç—à–∏—Ä—É—é—Ç—Å—è
- API Key ‚Üí —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –∫–æ–¥–µ (–¥–ª—è dev, –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è)
- HTTPS ‚Üí –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

### –ù–∞ —Å–µ—Ä–≤–µ—Ä–µ
- API Key validation ‚Üí –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- Prepared statements ‚Üí –∑–∞—â–∏—Ç–∞ –æ—Ç SQL injection
- Helmet ‚Üí –æ—Å–Ω–æ–≤–Ω—ã–µ security headers
- CORS ‚Üí –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- Input validation ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

### –ù–∞ –ë–î
- –ò–Ω–¥–µ–∫—Å—ã –ø–æ —á–∞—Å—Ç–æ –∏—â—É—â–∏–º—Å—è –ø–æ–ª—è–º
- Constraints ‚Üí –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
- –ë—ç–∫–∞–ø—ã ‚Üí —Ä–µ–≥—É–ª—è—Ä–Ω–æ–µ —Ä–µ–∑–µ—Ä–≤–Ω–æ–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–§—Ä–æ–Ω—Ç–µ–Ω–¥**
   - –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ CSS/JS ‚Üí –º–µ–Ω—å—à–µ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤
   - Service Worker –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ ‚Üí –±—ã—Å—Ç—Ä–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
   - IndexedDB –≤–º–µ—Å—Ç–æ localStorage ‚Üí –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

2. **–°–µ—Ä–≤–µ—Ä**
   - Batch API (`/api/scans/bulk`) ‚Üí –º–µ–Ω—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   - Connection pooling ‚Üí –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
   - Compression middleware ‚Üí —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞

3. **–ë–î**
   - –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—â—É—â–∏—Ö—Å—è –ø–æ–ª—è—Ö
   - Prepared statements ‚Üí –º–µ–Ω—å—à–µ –ø–∞—Ä—Å–∏–Ω–≥–∞

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

**–í–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ–µ:**
- –£–≤–µ–ª–∏—á–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã —Å–µ—Ä–≤–µ—Ä–∞ (CPU, RAM)
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º–æ—â–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –ë–î

**–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ:**
```
Load Balancer
‚îú‚îÄ App 1
‚îú‚îÄ App 2
‚îî‚îÄ App 3
    ‚Üì (–µ–¥–∏–Ω–∞—è –ë–î)
PostgreSQL (Master)
‚îî‚îÄ Replicas (–¥–ª—è —á—Ç–µ–Ω–∏—è)
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Unit —Ç–µ—Å—Ç—ã (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å)
```javascript
// –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
test('processScan —Ç—Ä–µ–±—É–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –ø–æ–ª—è', () => {
  expect(saveScanToDb({ sample: '', block: 'B1', well_name: 'W1' }))
    .toBe(false);
});
```

### Integration —Ç–µ—Å—Ç—ã
```bash
# –¢–µ—Å—Ç API
curl -X POST http://localhost:3000/api/scans/bulk \
  -H "X-API-Key: sampling-dev-key-2025" \
  -d '[{"device_id":"test","sample":"S1",...}]'
```

### End-to-end —Ç–µ—Å—Ç—ã
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –û—Ç–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
3. –û—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±—ã
4. –í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—é

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```
–ö–ª–∏–µ–Ω—Ç:
- –£—Å–ø–µ—à–Ω—ã—Ö —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–π –≤ –¥–µ–Ω—å
- –£—Å–ø–µ—à–Ω—ã—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π
- –°—Ä–µ–¥–Ω–∏–π —Ä–∞–∑–º–µ—Ä –æ—á–µ—Ä–µ–¥–∏ pending
- –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏

–°–µ—Ä–≤–µ—Ä:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø—Ä–æ—Å–æ–≤ /api/scans/bulk –≤ —á–∞—Å
- –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–∞
- –û—à–∏–±–∫–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
- –†–∞–∑–º–µ—Ä –ë–î

–ë–î:
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
- –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–æ–≤
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤
```

### Alerting

```
–û–®–ò–ë–ö–ò:
- –ë–æ–ª–µ–µ 10% –∑–∞–ø—Ä–æ—Å–æ–≤ —Å –æ—à–∏–±–∫–æ–π
- –í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞ > 5 —Å–µ–∫
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ–∫ –º–µ—Å—Ç–∞ –Ω–∞ –¥–∏—Å–∫–µ

–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–Ø:
- > 1000 pending –∑–∞–ø–∏—Å–µ–π
- Service Worker –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–µ —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
```

## üöÄ –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –∏ DevOps

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
```bash
npm run dev     # Node.js + Service Worker
```

### Docker
```bash
docker-compose up --build
```

### CI/CD (GitHub Actions)
```yaml
name: Deploy
on: [push]
jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm install
      - run: npm test
      - uses: docker/build-push-action@v2
        with:
          push: true
          registry: ghcr.io
```

---

**–í–µ—Ä—Å–∏—è:** 1.0.0
**–î–∞—Ç–∞:** 20 –¥–µ–∫–∞–±—Ä—è 2025
